# 🧠 ЛОГИКА TRUCKSERVICE MANAGER (ОБНОВЛЕННАЯ)

## 🎯 ОСНОВНАЯ АРХИТЕКТУРА С ПОЛЬЗОВАТЕЛЬСКИМИ СПИСКАМИ:

🏗️ СТРУКТУРА СИСТЕМЫ:
text
┌─────────────────┐    ┌──────────────────┐    ┌─────────────────┐
│   TELEGRAM BOT  │────│   REPOSITORIES   │────│   DATA SOURCES  │
│                 │    │                  │    │                 │
│ • User Sessions │    │ • Works Repo     │    │ • Excel Files   │
│ • Handlers      │    │ • Materials Repo │    │ • User Lists    │
│ • Admin Panel   │    │ • Accounting Repo│    │ • Cache Files   │
└─────────────────┘    └──────────────────┘    └─────────────────┘
         │                         │
         │                         │
         ▼                         ▼
┌─────────────────┐    ┌──────────────────┐
│  DOCUMENT FLOW  │    │   USER LISTS     │
│                 │    │                  │
│ • Excel Processor│   │ • Dynamic Menus  │
│ • Text Drafts   │    │ • Custom Works   │
└─────────────────┘    └──────────────────┘

## 🔄 ПОЛНЫЙ WORKFLOW С ПОЛЬЗОВАТЕЛЬСКИМИ СПИСКАМИ:

text
┌─────────────────────────────────────────────────────────────────┐
│                        START BOT (/start)                       │
└───────────────────────┬─────────────────────────────────────────┘
                        │
                        ▼
┌─────────────────────────────────────────────────────────────────┐
│                   ДИНАМИЧЕСКОЕ МЕНЮ С СПИСКАМИ                  │
│                                                                 │
│ 📋 ТИПОВОЙ ЗАКАЗ-НАРЯД                                         │
│ 📁 Список 1 (Пользовательский)                                 │
│ 📁 Список 2 (Пользовательский)                                 │
│ 📁 Список 3 (Пользовательский)                                 │
│ 🐛 DEBUG | 👨‍💻 АДМИН                                          │
└───────────────────────┬─────────────────────────────────────────┘
                        │
           ┌────────────┴────────────┐
           ▼                         ▼
┌─────────────────────┐    ┌─────────────────────┐
│  СТАНДАРТНЫЙ       │    │  ПОЛЬЗОВАТЕЛЬСКИЙ   │
│   РАЗДЕЛ           │    │      СПИСОК         │
│                     │    │                     │
│ • Загрузка работ    │    │ • Загрузка работ    │
│   из Excel базы     │    │   из папки списка   │
│ • Стандартный       │    │ • Создание сессии   │
│   процесс           │    │   с custom_list     │
└─────────────────────┘    └─────────────────────┘
           │                         │
           └────────────┬────────────┘
                        │
                        ▼
┌─────────────────────────────────────────────────────────────────┐
│                     ОБЩИЙ ПРОЦЕСС СОЗДАНИЯ ЗАКАЗА              │
│                                                                 │
│ 1. Ввод госномера → 2. Дата → 3. Номер заказа → 4. Исполнители │
│ 5. Выбор работ (из списка) → 6. Материалы → 7. Фото → 8. Создание │
└───────────────────────┬─────────────────────────────────────────┘
                        │
                        ▼
┌─────────────────────────────────────────────────────────────────┐
│                    СОЗДАНИЕ ДОКУМЕНТОВ                          │
│                                                                 │
│ • DocumentFactory создает Excel и текст                         │
│ • Сохранение в папку раздела (стандартную)                      │
│ • Отправка в рабочий чат                                        │
│ • Учет (если не DEBUG)                                          │
└─────────────────────────────────────────────────────────────────┘

## 📁 ЛОГИКА ПОЛЬЗОВАТЕЛЬСКИХ СПИСКОВ:

text
┌─────────────────────┐    ┌─────────────────────┐    ┌─────────────────────┐
│   СТРУКТУРА ПАПКИ  │───▶│   EXCEL ФАЙЛ        │───▶│   ЗАГРУЗКА В БОТ    │
│   "Список 1"       │    │   works_list_список │    │                     │
│                     │    │   1.xlsx           │    │ • Чтение DataFrame  │
│ • works_list_...    │    │                     │    │ • Валидация данных  │
│   .xlsx            │    │ • Колонка A: работа │    │ • Создание сессии   │
│                     │    │ • Колонка B: часы  │    │ • Добавление в меню │
└─────────────────────┘    └─────────────────────┘    └─────────────────────┘

## 🎯 CALLBACK ДАННЫЕ ДЛЯ ПОЛЬЗОВАТЕЛЬСКИХ СПИСКОВ:
- admin_panel - главное меню админки
- admin_create_list - создать список
- admin_manage_lists - управление списками  
- admin_back - назад
- custom_list_{list_name} - выбор пользовательского списка

## 📝 СОСТОЯНИЯ СЕССИЙ:
- awaiting_list_name - ждем название списка
- awaiting_excel:{list_name} - ждем Excel файл
- license_plate - ввод госномера (для custom_list)
- date - ввод даты
- order_number - номер заказа
- workers - исполнители
- selecting_works - выбор работ (из пользовательского списка)

## 🔧 МЕТОДЫ ДЛЯ ПОЛЬЗОВАТЕЛЬСКИХ СПИСКОВ:
1. get_available_lists() - получить список доступных списков
2. load_works_from_custom_list(list_name) - загрузить работы из списка
3. create_list_structure(list_name) - создать структуру папок
4. handle_custom_list_selection() - обработка выбора списка

## 💰 ПРОЦЕСС РАСЧЕТОВ (ЕДИНЫЙ):
text
Selected Works & Materials
        │
        ▼
┌───────────────┐    ┌───────────────┐    ┌───────────────┐
│  Calculate    │───▶│  Calculate    │───▶│  Convert to   │
│  Work Cost    │    │  Material Cost│    │  Words for    │
│  (Hours×2500) │    │  (Fixed)      │    │  Excel        │
└───────────────┘    └───────────────┘    └───────────────┘
        │                    │
        └─────────┬──────────┘
                  ▼
         ┌─────────────────┐
         │  Total Amount   │
         │  (Work+Material)│
         └─────────────────┘

✅ СИСТЕМА ПОЛЬЗОВАТЕЛЬСКИХ СПИСКОВ ПОЛНОСТЬЮ РЕАЛИЗОВАНА И РАБОТАЕТ!